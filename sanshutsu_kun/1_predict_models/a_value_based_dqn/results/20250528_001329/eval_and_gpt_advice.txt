【評価対象データ】
・対象期間: 直近3年分
・使用特徴量:
  - 馬齢（BAREI）
  - 性別コード（SEIBETSU_CODE）
  - 馬体重（BATAIJU）
  - 負担重量（FUTAN_JURYO）
  - 単勝人気順（TANSHO_NINKIJUN）
  - 距離（KYORI）
  - 芝/ダート（トラックコード）（TRACK_CODE）
  - 頭数（SHUSSO_TOSU）
  - 騎手3着以内率（KISHU_3IN_RATE）
  - 馬場状態（TENKO_CODE）
  - 調教師3着以内率（CHOKYOSHI_3IN_RATE）
  - 父系統ID（FATHER_LINEAGE）
  - 馬過去5走3着以内率（UMA_5R_3IN_RATE）
  - コース適性3着以内率（COURSE_3IN_RATE）
  - コース×馬過去5走3着以内率（COURSE_UMA_5R_3IN_RATE）
  - 父系統ターゲットエンコーディング（FATHER_LINEAGE_TE）
  - トラックコードターゲットエンコーディング（TRACK_CODE_TE）
  - 馬体重×距離（BATAIJU_KYORI）
  - 馬齢×負担重量（BAREI_FUTAN_JURYO）
  - 騎手×調教師ターゲットエンコーディング（KISHU_CHOKYOSHI_TE）
  - 馬×コースターゲットエンコーディング（UMA_COURSE_TE）
  - レース間隔（日数）（RACE_KANKAKU）
  - 馬場状態（良=1, それ以外=0）（TENKO_FINE）

--- 評価結果 ---
Accuracy: 0.8984
F1 Score: 0.7037
              precision    recall  f1-score   support

           0       0.89      0.99      0.94      6165
           1       0.96      0.55      0.70      1715

    accuracy                           0.90      7880
   macro avg       0.93      0.77      0.82      7880
weighted avg       0.91      0.90      0.89      7880

--- PRカーブからF1最大化となる最適閾値: 0.426 ---
--- 最適閾値での再評価 ---
Accuracy: 0.9397
F1 Score: 0.8599
              precision    recall  f1-score   support

           0       0.96      0.96      0.96      6165
           1       0.87      0.85      0.86      1715

    accuracy                           0.94      7880
   macro avg       0.91      0.91      0.91      7880
weighted avg       0.94      0.94      0.94      7880


--- GPT-4.1からの改善アドバイス ---
モデル評価結果と各種グラフ（ROC曲線、PR曲線、学習曲線、混同行列）から、以下の観点でモデル改善のためのアドバイスをまとめます。

---

#### 1. 全体評価・課題の整理
- **最適閾値適用後の性能**は、精度0.94・F1スコア0.86と高水準で、クラス1（3着以内）の検出性能も十分上昇しています（再現率0.85, 適合率0.87）。
- しかし、**クラス不均衡（3着以内は全体の約22%）**が存在し、デフォルト閾値（0.5）では「外れる馬（0）」の判定に偏りがちです（再現率: 0.55, 適合率: 0.96）。
- **PR曲線のカーブは滑らかで、閾値調整で良好なバランスが取れている**ものの、ROC曲線や混同行列から「3着以内」クラスのさらなる検出強化余地があります。

---

#### 2. 改善アドバイス

##### 2-1. 入力データ・特徴量の追加/強化

- **血統・母系統の情報の追加**  
  父系統IDだけでなく、母父・母系・近親馬の実績なども有効。特に重賞成績やコース適性の遺伝的傾向をターゲットエンコーディング等で追加。

- **レース当日の情報**  
  枠順（馬番）、パドック（馬体写真やコメント）、天候・気温・風速など「直前要素」を追加すると短期的な変動を捉えやすい。

- **馬自身の調子・成長曲線**  
  直近の成績変化（連続好走・凡走）、休み明け2走目や3歳馬の成長を示す特徴量を追加。

- **オッズや他馬との比較指標**  
  単勝・複勝オッズ、予想人気と実際人気のギャップ、同系逃げ馬数・展開予想値なども「期待値」の補助に。

##### 2-2. モデル構造・学習手法の工夫

- **クラス不均衡への対応強化**  
  - 現状、閾値調整は適切ですが、**損失関数にクラスウェイトを導入**（例：`BCEWithLogitsLoss(pos_weight=...)`など）し、「3着以内」誤判定のペナルティを上げるとモデル自体がより敏感に。
  - **サンプリング手法（SMOTE等の過学習防止策含む）**の検討も。

- **アンサンブル学習の導入**  
  DQN単体でなく、LightGBM・XGBoost等の決定木系や、他のNNモデルとの**バギング/スタッキング**でロバスト性を強化。

- **特徴量選択・重要度分析**  
  SHAP値やPermutation Importanceを使い、「過剰な派生特徴量」や不要なカテゴリ変数の整理・圧縮・多重共線性の低減を検討。

- **時系列性の活用**  
  馬の成績や騎手・調教師の「トレンド」など、**過去レースの時系列情報**をRNN/1D-CNNや時系列特徴量として追加するのも有効。

##### 2-3. モデル評価・運用面

- **閾値最適化の定期的な見直し**  
  レース条件や季節ごとでPRカーブ・ROCカーブの形状が変化するため、**閾値の再最適化や条件別評価**を定期的に実施。
- **クロスバリデーション/分割手法の見直し**  
  年度・開催場ごとのリークや偏りを避けるため、**グループKFoldや時系列分割**を検討。

---

### 3. グラフ画像からの
