【評価対象データ】
・対象期間: 直近1080日分
・使用特徴量:
  - 馬齢（BAREI）
  - 性別コード（SEIBETSU_CODE）
  - 馬体重（BATAIJU）
  - 負担重量（FUTAN_JURYO）
  - 単勝人気順（TANSHO_NINKIJUN）
  - 枠順（WAKUBAN）
  - 距離（KYORI）
  - 芝/ダート（トラックコード）（TRACK_CODE）
  - 頭数（SHUSSO_TOSU）
  - 騎手3着以内率（KISHU_3IN_RATE）
  - 馬場状態（TENKO_CODE）
  - 調教師3着以内率（CHOKYOSHI_3IN_RATE）
  - 父系統ID（FATHER_LINEAGE）
  - 馬過去5走3着以内率（UMA_5R_3IN_RATE）
  - コース適性3着以内率（COURSE_3IN_RATE）
  - コース×馬過去5走3着以内率（COURSE_UMA_5R_3IN_RATE）
  - 父系統ターゲットエンコーディング（FATHER_LINEAGE_TE）
  - トラックコードターゲットエンコーディング（TRACK_CODE_TE）
  - 馬体重×距離（BATAIJU_KYORI）
  - 馬齢×負担重量（BAREI_FUTAN_JURYO）
  - 騎手×調教師ターゲットエンコーディング（KISHU_CHOKYOSHI_TE）
  - 馬×コースターゲットエンコーディング（UMA_COURSE_TE）
  - レース間隔（日数）（RACE_KANKAKU）
  - 馬場状態（良=1, それ以外=0）（TENKO_FINE）

--- 評価結果 ---
Accuracy: 0.9619
F1 Score: 0.9064
              precision    recall  f1-score   support

           0       0.96      0.99      0.98      6165
           1       0.97      0.85      0.91      1715

    accuracy                           0.96      7880
   macro avg       0.97      0.92      0.94      7880
weighted avg       0.96      0.96      0.96      7880

--- PRカーブからF1最大化となる最適閾値: 0.437 ---
--- 最適閾値での再評価 ---
Accuracy: 0.9768
F1 Score: 0.9468
              precision    recall  f1-score   support

           0       0.99      0.98      0.99      6165
           1       0.94      0.95      0.95      1715

    accuracy                           0.98      7880
   macro avg       0.97      0.97      0.97      7880
weighted avg       0.98      0.98      0.98      7880


--- GPT-4.1からの改善アドバイス ---
モデル改善のためのアドバイス

評価指標や学習曲線、混同行列、ROC・PRカーブなど総合的にモデル性能は非常に高く、現状のデータ・特徴量では飽和感がありますが、さらなる精度・汎化性能向上や業務適用性強化のため、以下の点を検討してください。

1. クラス不均衡対策
- 混同行列・F1スコア詳細より、3着以内（正例）に対するrecall・precisionともに高いが、実際の予測業務ではわずかな取りこぼしも大きな損失につながります。  
- サンプルオーグメンテーションやSMOTE等による正例増強、コスト関数の調整（クラス重み付け）を再検討。

2. 閾値最適化＆業務要件との整合
- PRカーブベースで閾値調整しF1最大化を実施しているが、実運用ではprecision重視かrecall重視か明確にし、最適閾値を「ビジネス要件ベース」で再検討。

3. 特徴量エンジニアリングのさらなる強化
- 既存のクロス特徴量・ターゲットエンコーディングは有効。ただし、  
　- 「レース当日の天候」「馬場の含水率」など追加の気象・馬場状態特徴  
　- 直近の調子（レース直近×体重変化、脚質傾向等）の時系列要素  
　- 他馬との相対的な能力値（同レース他馬との差分特徴）  
　などを追加検討。

4. モデルの解釈性・説明性向上
- 業務応用や現場ユーザーの納得感を高めるため、SHAP値等による特徴量重要度や個別予測根拠の可視化を推進。

5. モデルアンサンブル・ハイブリッド化
- DQN単体で高精度だが、LightGBM/ランダムフォレスト等のツリー系モデルや他NN系（LSTM等）とのアンサンブルでわずかな取りこぼし低減・安定性向上が期待できる。

6. 時系列およびデータリーク対策
- 学習曲線・ROC, PRカーブから過学習傾向は小さいが、馬や騎手の「未来情報」やターゲットエンコーディングのデータリークを再点検。  
- 特に「コース×馬」などクロス特徴量は未来情報混入がないか確認。

7. シミュレーションによる実運用効果検証
- 精度指標だけでなく、「実際の馬券購入シミュレーション」や「投資回収率」等も検証して実務適用性を定量評価。

8. モデル運用面
- 新データ・新馬・新騎手など未知パターンへの対応力（オンライン学習、定期再学習）、外れ値・異常値の自動検知も運用上重要。

---

【補足：グラフ画像所見】
- ROC/PRカーブ：AUC・F1ともに高く、閾値調整でバランス改善傾向が明確。
- 学習曲線：過学習なし、十分な学習量。
- 混同行列：正例の取りこぼし（FN）がまだわずかに存在、要追加対策。

---

全体として「モデルは非常に高性能だが、実運用・ビジネス要件に即した閾値設計」「追加の特徴量・説明性・アンサンブル化による微改善」「データリークや未知パターン耐性の強化」を進めることでさらに現場価値が高まります。
